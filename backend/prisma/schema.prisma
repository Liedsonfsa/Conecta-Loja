generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model usuario {
  id        Int        @id @default(autoincrement())
  name      String     @db.VarChar(100)
  email     String     @unique @db.VarChar(255)
  password  String     @db.VarChar(255)
  contact   String     @db.VarChar(20)
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  avatar    String?
  carrinho  carrinho?
  enderecos endereco[]
  pedidos   pedido[]

  @@map("usuarios")
}

model endereco {
  id                     Int      @id @default(autoincrement())
  cep                    String   @db.VarChar(10)
  logradouro             String   @db.VarChar(255)
  numero                 String   @db.VarChar(10)
  complemento            String?  @db.VarChar(100)
  informacoes_adicionais String?  @db.VarChar(255)
  bairro                 String   @db.VarChar(100)
  cidade                 String   @db.VarChar(100)
  estado                 String   @db.VarChar(2)
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @updatedAt @map("updated_at")
  usuarioId              Int
  isPrincipal            Boolean  @default(false)
  usuario                usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pedidos                pedido[]

  @@map("enderecos")
}

model pedido {
  id              Int                       @id @default(autoincrement())
  precoTotal      Decimal                   @db.Decimal(10, 2)
  status          OrderStatus               @default(RECEBIDO)
  createdAt       DateTime                  @default(now()) @map("created_at")
  updatedAt       DateTime                  @updatedAt @map("updated_at")
  usuarioId       Int
  cupomId         Int?
  enderecoId      Int?
  produtos        pedido_produto[]
  statusHistorico pedido_status_historico[]
  cupom           cupom?                    @relation(fields: [cupomId], references: [id])
  endereco        endereco?                 @relation(fields: [enderecoId], references: [id])
  usuario         usuario                   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("pedidos")
}

model pedido_produto {
  id            Int     @id @default(autoincrement())
  quantidade    Int     @default(1)
  pedidoId      Int
  produtoId     Int
  precoUnitario Decimal @default(0.00) @db.Decimal(10, 2)
  pedido        pedido  @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto       product @relation(fields: [produtoId], references: [id])

  @@unique([pedidoId, produtoId])
  @@map("pedido_produto")
}

model funcionario {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  avatar   String? @db.Text // Foto do funcionário em base64 (opcional)

  cargoId Int? // Temporariamente opcional
  cargo   cargo? @relation(fields: [cargoId], references: [id])

  lojaId Int
  loja   store @relation(fields: [lojaId], references: [id])

  // Relations
  statusHistorico pedido_status_historico[] // UM funcionário pode criar VÁRIOS registros de status
}

model cargo {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  funcionarios funcionario[]
}

model store {
  id             Int           @id @default(autoincrement())
  name           String
  contact        String
  email          String
  description    String
  image          String?
  accentColor    String?       @default("#F59E0B") @map("accent_color")
  bannerImageUrl String?       @map("banner_image_url")
  city           String?
  customCSS      String?       @map("custom_css")
  footerMessage  String?       @map("footer_message")
  logoUrl        String?       @map("logo_url")
  primaryColor   String?       @default("#2563EB") @map("primary_color")
  secondaryColor String?       @default("#059669") @map("secondary_color")
  state          String?
  street         String?
  theme          String?       @default("modern")
  welcomeMessage String?       @map("welcome_message")
  zipCode        String?       @map("zip_code")
  funcionarios   funcionario[]

  @@map("store")
}

model cupom {
  id        Int          @id @default(autoincrement())
  codigo    String       @unique @db.VarChar(50)
  valor     Decimal      @db.Decimal(10, 2)
  status    CouponStatus @default(ATIVO)
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")
  pedidos   pedido[]

  @@map("cupons")
}

model category {
  id             Int       @id @default(autoincrement())
  name           String    @unique
  activeProducts Int       @default(0)
  totalValue     Decimal   @default(0) @db.Decimal(10, 2)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  products       product[]

  @@map("categoria")
}

model product {
  id           Int                @id @default(autoincrement())
  name         String
  description  String
  price        Decimal            @db.Decimal(10, 2)
  categoryId   Int
  available    Boolean            @default(true)
  image        String?
  discount     Decimal?           @db.Decimal(10, 2)
  discountType DiscountType?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  estoque      Int                @default(0)
  carrinhos    carrinho_produto[]
  pedidos      pedido_produto[]
  category     category           @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@map("produto")
}

model carrinho {
  id        Int                @id @default(autoincrement())
  usuarioId Int                @unique
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  itens     carrinho_produto[]
  usuario   usuario            @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("carrinhos")
}

model carrinho_produto {
  id         Int      @id @default(autoincrement())
  carrinhoId Int
  produtoId  Int
  quantidade Int      @default(1)
  carrinho   carrinho @relation(fields: [carrinhoId], references: [id], onDelete: Cascade)
  produto    product  @relation(fields: [produtoId], references: [id])

  @@unique([carrinhoId, produtoId])
  @@map("carrinho_produto")
}

model pedido_status_historico {
  id          Int          @id @default(autoincrement())
  pedidoId    Int
  status      OrderStatus
  observacao  String?
  criadoPor   Int?
  createdAt   DateTime     @default(now()) @map("created_at")
  funcionario funcionario? @relation(fields: [criadoPor], references: [id])
  pedido      pedido       @relation(fields: [pedidoId], references: [id], onDelete: Cascade)

  @@map("pedido_status_historico")
}

enum DiscountType {
  PERCENTAGE
  FIXED_VALUE
}

enum OrderStatus {
  RECEBIDO
  AGUARDANDO_PAGAMENTO
  PAGAMENTO_APROVADO
  PREPARO
  ENVIADO_PARA_ENTREGA
  ENTREGUE
  CANCELADO
  TENTATIVA_ENTREGA_FALHADA
}

enum CouponStatus {
  ATIVO
  INATIVO
}
